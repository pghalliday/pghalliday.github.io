<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Auto build and deploy GitHub pages with Travis-CI</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

        <!-- Table CSS -->
        <link rel="stylesheet" href="/css/table.css">

    </head>
    <body>

        <div class="site">
          <div class="header">
            <h1 class="title"><a href="/">pghalliday</a></h1>
            <a class="extra" href="/">home</a>
          </div>

          <h2>Auto build and deploy GitHub pages with Travis-CI</h2>
<p class="meta">19 Sep 2014</p>

<div class="post">
<p>So you have an existing Jekyll GitHub pages project but you also have some preliminary build steps and/or tests that you need to run before pushing to GitHub to deploy. Now you&#39;re tired of running these steps manually and keeping the built artifacts in your repository. One answer (and the answer illustrated here) is to use Travis-CI to automate the build and deploy steps for you and retire the automatic Jekyll build that GitHub would perform. So here goes...  </p>

<p>First checkout the GitHub pages project to a new <code>deploy</code> branch.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">git checkout -b deploy
git push -u origin deploy
</code></pre></div>
<p>Enable Travis-CI on your GitHub pages project.</p>

<p>Set <code>deploy</code> to be the default branch in the GitHub web interface. This will be the branch that you do most of your work in or make future branches from, so it makes sense for it to be the default. You will no longer manually make changes to the <code>master</code> branch.</p>

<p>Add the SSH key entries to <code>.gitignore</code> as illustrated here</p>

<script src="https://gist.github.com/pghalliday/240fe740d523dad21d3f.js?file=gitignore.sh"></script>

<p>Generate a private/public key pair without passphrase in the repo directory</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">ssh-keygen -t rsa -C &quot;your_email@example.com&quot; -f id_rsa -N &#39;&#39;
</code></pre></div>
<p>Add the public key (<code>id_rsa.pub</code>) to the GitHub repository as a &#39;Deploy Key&#39; through the web interface. We are using deploy keys so that we can make them specific to a single repository. An alternative approach could use &#39;Personal access tokens&#39; but they would then allow access to all repositories associated with the given account - this might be preferable if special GitHub accounts are created specifically for Travis builds and they need to work with multiple repositories.</p>

<p>Install the travis gem</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">gem install travis
</code></pre></div>
<p>Login to travis with your GitHub credentials</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">travis login
</code></pre></div>
<p>Encrypt the SSH key to generate <code>id_rsa.enc</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">travis encrypt-file id_rsa
</code></pre></div>
<p>Add the <code>deploy.sh</code> file as given here and mark it executable</p>

<script src="https://gist.github.com/pghalliday/240fe740d523dad21d3f.js?file=auto-build-and-deploy-github-pages-with-travis-ci.sh"></script>
<div class="highlight"><pre><code class="language-text" data-lang="text">chmod +x deploy.sh
</code></pre></div>
<p>Add a <code>.travis.yml</code> to the branch as given here</p>

<script src="https://gist.github.com/pghalliday/240fe740d523dad21d3f.js?file=deploy.travis.yml"></script>

<p>Add a <code>build</code> task to your <code>Rakefile</code> that at least calls <code>jekyll build</code> but should also perform the additional build and test steps that you wanted Travis-CI to do in the first place.</p>

<p>Commit your changes to the <code>deploy</code> branch but don&#39;t push them yet</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">git add -A .
git commit -m &quot;adding travis auto build and deploy support&quot;
</code></pre></div>
<p>Switch back to the <code>master</code> branch that GitHub will use for the source of your GitHub pages site</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">git checkout master
</code></pre></div>
<p>Delete all the existing files and create a <code>.nojekyll</code> file to let GitHub know that it does not need to run Jekyll again.</p>

<p>Add a <code>.travis.yml</code> file to the <code>master</code> branch as given here to prevent Travis-CI building the master branch when it changes. After all there is nothing for Travis-CI to do in the master branch</p>

<script src="https://gist.github.com/pghalliday/240fe740d523dad21d3f.js?file=master.travis.yml"></script>

<p>Commit the <code>master</code> branch and push both branches back to GitHub</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">git add -A .
git commit -m &quot;Prepare master branch as a deployment target&quot;
git push --all
</code></pre></div>
<p>This will trigger Travis-CI to do its first deployment from the <code>deploy</code> branch.</p>

</div>


<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'pghalliday';
    var disqus_identifier = 'auto-build-and-deploy-github-pages-with-travis-ci';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



          <div class="footer">
            <div class="contact">
              <p>
                Peter Halliday<br />
                Software Engineer<br />
                pghalliday@gmail.com
              </p>
            </div>
            <div class="contact">
              <p>
                <a href="https://github.com/pghalliday">github.com/pghalliday</a><br />
                <a href="https://twitter.com/petehalliday">twitter.com/petehalliday</a><br />
              </p>
            </div>
          </div>
        </div>

        <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'pghalliday';

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
          }());
        </script>
    
    </body>
</html>
